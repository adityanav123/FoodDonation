{% extends 'base.html' %}


{% block title %} {{ user.username }} | MAP {% endblock %}
{% block head %}
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/topojson.v0.min.js"></script>
    <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.css" />
    <script src="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.js"></script>
<style>
    #mapid {
    left:0;
    top:0;
    height:50%;
    width:70%;
    position:absolute;

}
    .map-responsive{
    overflow:hidden;
    padding-bottom:76.25%;
    position:relative;
    height:0;

    }
</style>
{% endblock %}
{% block navigation %}
	<div class = "row">
		<div class = "col">
	<form method = "post" action = "{% url 'homePage' %}">
		{% csrf_token %}
		<button type = "submit" class = "btn btn-outline-dark navbar-btn"> <strong>Home </strong></button>
	</form>
</div>
<div class = "col">
			<form method = "get" action = "{% url 'edit_profile' %}">
				{% csrf_token %}
				<button type = "submit" class = "btn btn-outline-dark navbar-btn"> <strong> Update Profile </strong></button>
			</form>
		</div>
	</div>
{% endblock %}

{% block content %}
 <h1>Nearby Receiver</h1>
        {% if users %}
        <ul>
        {% for i in users %}
            <li>
            {{ i.username }}
            </li>
        {% endfor %}
        </ul>
        {% endif %}
 <div class="map-responsive container-fluid">
 <div id="mapid"></div>
 </div>

<script>
	navigator.geolocation.getCurrentPosition(function(location) {
  var latlng = new L.LatLng(location.coords.latitude, location.coords.longitude);
  var mymap = L.map('mapid').setView(latlng, 13)
  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    maxZoom: 18,
     id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoiYmJyb29rMTU0IiwiYSI6ImNpcXN3dnJrdDAwMGNmd250bjhvZXpnbWsifQ.Nf9Zkfchos577IanoKMoYQ'
  }).addTo(mymap);

  var marker = L.circleMarker(latlng).addTo(mymap);
            mark1=[];
            mark2=[];
            var j=0,k=0;
            {% for i in lat %}
                mark1[j]={{ i }};
                j++;
            {% endfor %}
             {% for i in lang %}
                mark2[k]={{ i }};
                k++;
            {% endfor %}

            var pop_up = [];
            {% if users %}
                {% for i in users %}
                     var st =  " {{ i.username }} ";
                    pop_up.push( st );  // variable can only store integer values.
                {% endfor %}
            {% endif %}
            for(var m=0;m<mark1.length;m++) {
                var circle = L.circleMarker([mark1[m],mark2[m]], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 1.5,
                    radius: 5
                }).addTo(mymap);
                // var m1 = "mark3[m]";
               circle.bindPopup(
                '' + pop_up[m]).openPopup();
            }

});
</script>

{% endblock %}